<h2 align="center"> ğŸ’‡â€â™€ï¸ëª¨ë½ëª¨ë½ (æ¯›ï¥œæ¯›ï¥œ) - ë§ì¶¤í˜• í—¤ì–´ìŠ¤íƒ€ì¼ ì¶”ì²œ ì„œë¹„ìŠ¤</h2>



_ë‚´ ì–¼êµ´í˜•ì— ë§ëŠ” í—¤ì–´ìŠ¤íƒ€ì¼ì„ ì¶”ì²œ ë°›ê³  ì‹¶ë‹¤ë©´?_ <br> 
ğŸ‘‰ [ëª¨ë½ëª¨ë½ ë°”ë¡œ ê°€ê¸°](https://morak-morak-demo.vercel.app/)


### **ğŸ‘© í•©ì„±ì‚¬ì§„ìœ¼ë¡œ í—¤ì–´ìŠ¤íƒ€ì¼ ì¶”ì²œ** <br>
: ì‚¬ìš©ìì˜ ì–¼êµ´ ì´ë¯¸ì§€ë¥¼ í†µí•´ ì–¼êµ´í˜•(í•˜íŠ¸í˜•, ê¸´í˜•, ê³„ë€í˜•, ì‚¬ê°í˜•, ë‘¥ê·¼í˜•)ì„ ë¶„ì„í•œ í›„, ë¶„ì„ëœ ì–¼êµ´í˜•ì— ì–´ìš¸ë¦¬ëŠ” í—¤ì–´ìŠ¤íƒ€ì¼ì„ í•©ì„±í•œ ì‚¬ì§„ 3ì¥ê³¼ ì–´ìš¸ë¦¬ì§€ ì•ŠëŠ” í—¤ì–´ìŠ¤íƒ€ì¼ì„ í•©ì„±í•œ ì‚¬ì§„ 3ì¥ì„ ê°€ì‹œì ìœ¼ë¡œ ë³´ì—¬ì£¼ëŠ” ê¸°ëŠ¥

### **âœ’ï¸ ë””ìì´ë„ˆ ì¶”ì²œ** <br> 
: ìœ„ì˜ ê¸°ëŠ¥ì—ì„œ ì¶”ì²œëœ í—¤ì–´ìŠ¤íƒ€ì¼ì„ ê¸°ë°˜ìœ¼ë¡œ, í•´ë‹¹ í—¤ì–´ìŠ¤íƒ€ì¼ì„ ì „ë¬¸ í—¤ì–´ë¡œ ë“±ë¡í•œ ë””ìì´ë„ˆë“¤ì„ ë¦¬ìŠ¤íŠ¸ í˜•íƒœë¡œ ì œê³µí•˜ëŠ” ê¸°ëŠ¥

### **ğŸ‘ï¸â€ğŸ—¨ï¸ ë””ìì´ë„ˆ í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„±** <br>
: ë””ìì´ë„ˆê°€ ìì‹ ì˜ ì •ë³´, ê·¼ë¬´ì§€, ìê²©ì¸ì¦ì„œ, ì „ë¬¸í—¤ì–´, í—¤ì–´ ì´ë¯¸ì§€, ê°€ê²© ë“±ì„ ë„£ì–´ ìì‹ ë§Œì˜ í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ìƒì„±í•˜ëŠ” ê¸°ëŠ¥



## ğŸ‘¥ íŒ€ì›

<div align=center> 

  | ê¹€ì§€ì›(BACK) | ì˜¤ì˜ˆë¦°(FRONT) | í™©ì„œì •(AI) | 
  | :---: | :---: | :---: | 
  | <img src="https://avatars.githubusercontent.com/JiwonKim08" alt="profile" width="180" height="180"> | <img src="https://avatars.githubusercontent.com/YelynnOh" alt="profile"   width="180" height="180"> | <img src="https://avatars.githubusercontent.com/seojungH" alt="profile" width="180" height="180"> |
  | [JiwonKim08](https://github.com/JiwonKim08) | [YelynnOh](https://github.com/YelynnOh) | [seojungH](https://github.com/seojungH) | 

</div>

## âœ¨ ê¸°ìˆ  ìŠ¤íƒ

<div align=center> 
  <br>
  <h3>FE</h3>
  <img src="https://img.shields.io/badge/Next.js-eeeeee?style=for-the-badge&logo=Next.js&logoColor=black">
  <img src="https://img.shields.io/badge/TypeScript-3178C6?style=for-the-badge&logo=TypeScript&logoColor=white"/>
  <img src="https://img.shields.io/badge/TailwindCss-06B6D4?style=for-the-badge&logo=TailwindCss&logoColor=white"/>
  <img src="https://img.shields.io/badge/ReactQuery-FF4154?style=for-the-badge&logo=ReactQuery&logoColor=white"/>
  <img alt="Yarn" src="https://img.shields.io/badge/Yarn-2C8EBB?style=for-the-badge&logo=yarn&logoColor=white" />
  <img alt="Yarn" src="https://img.shields.io/badge/Vercel-000000?style=for-the-badge&logo=vercel&logoColor=white" />


  <h3>BE</h3>
  <img src="https://img.shields.io/badge/spring-6DB33F?style=for-the-badge&logo=spring&logoColor=white"> 
  <img src="https://img.shields.io/badge/mysql-4479A1?style=for-the-badge&logo=mysql&logoColor=white">  

  <h3>AI</h3>
  <img src="https://img.shields.io/badge/flask-000000?style=for-the-badge&logo=flask&logoColor=white">


  <h3>ê³µí†µ</h3>
  <img src="https://img.shields.io/badge/AWS-232F3E?style=for-the-badge&logo=amazonwebservices&logoColor=white">
  <img src="https://img.shields.io/badge/github-181717?style=for-the-badge&logo=github&logoColor=white">
  <img src="https://img.shields.io/badge/git-F05032?style=for-the-badge&logo=git&logoColor=white">

  <br>
</div>


## â” How to install, build, test â”
- FRONT
    - 
    - front ë ˆí¬ì§€í† ë¦¬ì˜ ì½”ë“œë¥¼ ë¡œì»¬ í™˜ê²½ìœ¼ë¡œ pullí•œë‹¤.
    - í”„ë¡œì íŠ¸ í´ë” ê°€ì¥ ìƒìœ„ í´ë”ì— `.env.local` íŒŒì¼ ìƒì„± í›„ í•„ìš”í•œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì…ë ¥í•œë‹¤. 
    -  VScodeì˜ í„°ë¯¸ë„ì„ ì—´ì–´ `yarn` ëª…ë ¹ì–´ë¡œ í•„ìš”í•œ ì˜ì¡´ì„±ì„ ì„¤ì¹˜í•œë‹¤. 
    - `yarn dev` ëª…ë ¹ì–´ë¡œ Next.js ê°œë°œ ì„œë²„ë¥¼ ë„ìš´ í›„, `http://localhost:3000`ì„ ì§„ì… ì‹œ ê°œë°œ í™”ë©´ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. 
- BACK
    - 
    - back ë ˆí¬ì§€í† ë¦¬ì—ì„œ ìµœì‹ ì½”ë“œë¥¼ IntelliJë¡œ pullí•œ ë’¤, `application.yml` íŒŒì¼ì— ì„¤ì •ê°’ì„ ì…ë ¥í•œë‹¤.
    - ì˜¤ë¥¸ìª½ ìƒë‹¨ì— Run ë²„íŠ¼ì„ ëˆŒëŸ¬ localhost ì„œë²„ë¥¼ ë„ì–´ í„°ë¯¸ë„ì— ëœ¬ ì£¼ì†Œë¡œ ë“¤ì–´ê°„ë‹¤.
    - í”„ë¡ íŠ¸ì™€ ì—°ê²°ë˜ê¸° ì „ì´ë¯€ë¡œ(ë°°í¬ì£¼ì†Œê°€ ì•„ë‹Œ localhostì´ë¯€ë¡œ), `http://localhost:8080/swagger-ui/`ì—ì„œ API í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•˜ë‹¤.
    - ë‹¨, í† í° ë°œê¸‰ ì „ì´ë¯€ë¡œ(ë°°í¬ì£¼ì†Œê°€ ì•„ë‹Œ localhostì´ë¯€ë¡œ), í† í°ì´ í•„ìš”í•œ APIëŠ” í…ŒìŠ¤íŠ¸ ë¶ˆê°€ëŠ¥í•˜ë‹¤.

- AI
    - 
    - ai ë ˆí¬ì§€í† ë¦¬ì˜ ì½”ë“œë¥¼ ë¡œì»¬ í™˜ê²½ìœ¼ë¡œ pull í•œë‹¤. 
    - `.env` íŒŒì¼ì„ ìƒì„±í•˜ê³  í•„ìš”í•œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì…ë ¥í•œë‹¤. 
    - pycharm ì—ì„œ í„°ë¯¸ë„ì„ ì—´ê³  `pip install -r requirements.txt`ë¥¼ í†µí•´ í•„ìš”í•œ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•œë‹¤.
    - main2.py íŒŒì¼ì„ ì‹¤í–‰ì‹œí‚¨ë‹¤.
    - `http://127.0.0.1:5000` ë¡œ ì ‘ì†í•œë‹¤.
    - ai ì„œë²„ë§Œ ë”°ë¡œ ì‹¤í–‰ì‹œí‚¬ì‹œ, ì‚¬ìš©ìì˜ ì¹´ì¹´ì˜¤í†¡ ì •ë³´ê°€ ë„˜ì–´ê°€ì§€ ì•Šìœ¼ë¯€ë¡œ ai ê¸°ëŠ¥ë§Œ ì´ìš©í•˜ê³  ì‹¶ë‹¤ë©´ `http://127.0.0.1:5000/api/receivekakaoid` ë¡œ {
  "token": "í† í°ë‚´ìš©",
  "kakao_id": "ì•„ì´ë””ìˆ«ì"
} apië¥¼ post í•œ í›„ì— ì§„í–‰í•œë‹¤. 


<br>
cf. ì„œë²„ê°„ ì—°ê²°ë™ì‘(FRONT-BACK-AI)ì€ localhostì—ì„œ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.


## ğŸ’¦ sample data ì„¤ëª… (AI)

<img src="https://github.com/Algo-Artisans/.github/assets/99666136/529ab123-da07-4282-8c8c-56da8dca519b" alt="í•©ì„± ê²°ê³¼" width="400" height="600">


## ğŸ›  í”„ë¡œì íŠ¸ ì „ì²´ êµ¬ì¡°ë„
![ì „ì²´êµ¬ì¡°ë„](https://github.com/Algo-Artisans/.github/assets/99666136/f9dc4e53-de50-4f62-b50c-b87226e54f9b)

## ğŸ¯ ì£¼ìš” ì½”ë“œ ì„¤ëª…
- ì½”ë“œ ì„¤ëª…ì€ ì¶”ì„ì²˜ë¦¬ í•´ë‘ì—ˆìŠµë‹ˆë‹¤.
- FRONT
    -
    - Next.jsì˜ middleware í™œìš© ì½”ë“œ
        - ì‚¬ìš©ì ì¸ì¦ ë° ë¦¬ë‹¤ì´ë ‰íŠ¸ìš©ìœ¼ë¡œ êµ¬ì„±
    
    ```typescript
    import { NextResponse } from 'next/server';
    import type { NextRequest } from 'next/server';

    export async function middleware(request: NextRequest) {
    //NOTE : ì¹´ì¹´ì˜¤í†¡ì—ì„œ í† í° ë°›ìœ¼ë©´ ê·¸ í† í° ì¿ í‚¤ì— ì €ì¥
    if (request.nextUrl.pathname === '/auth') {
    //NOTE : urlì—ì„œ í† í° ë¶€ë¶„ ë¶„ë¦¬, ì¿ í‚¤ì— ì €ì¥
    const accessToken = request.nextUrl.searchParams.get('accessToken');

    // NOTE : ì´ë¯¸ ê°€ì…í•œ ì‚¬ëŒì¼ ê²½ìš° í™ˆ í™”ë©´ìœ¼ë¡œ ì´ë™ ì•„ë‹ˆë©´ íšŒì›ê°€ì…ìœ¼ë¡œ
    const firstLogin = request.nextUrl.searchParams.get('firstLogin');

    const response =
      firstLogin === 'no'
        ? NextResponse.redirect(new URL('/designerList', request.nextUrl))
        : NextResponse.redirect(new URL('/signup', request.nextUrl));

    if (accessToken) {
      response.cookies.set('accessToken', accessToken, { path: '/' });
    } else {
      // NOTE : ì•¡ì„¸ìŠ¤ í† í°ì´ ì—†ëŠ” ê²½ìš° ìš”ì²­ì„ ê±°ë¶€í•˜ê³  ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        return NextResponse.redirect(new URL('/login', request.nextUrl));
    }   

        return response;
        }
    }

    export const config = {
        matcher: ['/', '/auth'],
    };

    ```
    - S3 ë²„í‚·ì— ì €ì¥ë˜ì–´ ìˆëŠ” 'ìœ ì €ë³„ AIí•©ì„± ì´ë¯¸ì§€' ê°ì²´ ì§ì ‘ ê°€ì ¸ì˜¤ê¸°
        - ìš°ì„  ì•„ë˜ì™€ ê°™ì€ íŒ¨í‚¤ì§€ê°€ í•„ìš”í•¨
        ```json
        "@aws-sdk/client-s3": "3.540.0",
        "@aws-sdk/credential-provider-node": "^3.554.0",
        ```
    ```typescript
    //useGetS3Image.ts
    const getS3Image = async (objectKeys: string[]): Promise<S3ImageProps> => {
    try {
        const s3Client = new S3Client({
        region: process.env.NEXT_PUBLIC_S3_REGION,
        credentials: {
            accessKeyId: process.env.NEXT_PUBLIC_KEY_ID || '',
            secretAccessKey: process.env.NEXT_PUBLIC_SECRET_ACCESS_KEY || '',
        },
        });

        const images = await Promise.all(
        objectKeys.map(async (objectKey) => {
            const command = new GetObjectCommand({
            Bucket: process.env.NEXT_PUBLIC_S3_BUCKET_NAME,
            Key: objectKey,
            });
            const response = await s3Client.send(command);

            if (response.Body) {
            const str = await response.Body.transformToByteArray();
            const blob = new Blob([str], { type: 'image/png' });
            return URL.createObjectURL(blob);
            }
            return ''; // ì´ë¯¸ì§€ê°€ ì—†ëŠ” ê²½ìš° ë¹ˆ ë¬¸ìì—´ ë°˜í™˜
        }),
        );

        // ì´ë¯¸ì§€ URL ë°°ì—´ ë°˜í™˜
        return { urls: images.filter((url) => url !== '') };
    } catch (error) {
        console.error('S3 ì´ë¯¸ì§€ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
        throw error;
    }
    };
    ```

- BACK
    -
    - QueryDSLì„ ì‚¬ìš©í•´ 'í—¤ì–´ë””ìì´ë„ˆ ì¶”ì²œ ê¸°ëŠ¥' êµ¬í˜„
    ```java
    public List<Portfolio> searchHairNames(List<String> hairNames) {
        QPortfolio portfolio = QPortfolio.portfolio;
        QPortfolioHairStyle qportfolioHairStyle = QPortfolioHairStyle.portfolioHairStyle;

        Set<Long> portfolioIds = new HashSet<>();
    
        // ë¦¬ìŠ¤íŠ¸ hairNamesì—ì„œ hairnameì„ êº¼ë‚´ Id ê°€ì ¸ì˜¤ê¸°
        for (String hairName : hairNames) {
            Long hairStyleId = queryFactory
                    .select(QHairStyle.hairStyle.hairStyleId)
                    .from(QHairStyle.hairStyle)
                    .where(QHairStyle.hairStyle.hairName.eq(hairName))
                    .fetchOne();

            // hairStyledIdì— ëŒ€ì‘ë˜ëŠ” portfolioId ê°€ì ¸ì˜¤ê¸°
            if (hairStyleId != null) {
                List<Long> portfolioIdsForHairName = queryFactory
                        .selectDistinct(qportfolioHairStyle.portfolio.portfolioId)
                        .from(qportfolioHairStyle)
                        .where(qportfolioHairStyle.hairStyle.hairStyleId.eq(hairStyleId))
                        .fetch();

                portfolioIds.addAll(portfolioIdsForHairName);
            }
        }
     ```
    
     - 'ë””ìì´ë„ˆ í¬íŠ¸í´ë¦¬ì˜¤ ë“±ë¡ ê¸°ëŠ¥' êµ¬í˜„
     ```java
     public PortfolioResDto createPortfolio(HttpServletRequest httpRequest, PortfolioReqDto portfolioReqDto) {
        // í´ë¼ì´ì–¸íŠ¸ ì •ë³´ë¥¼ í† í°ì—ì„œ ì¶”ì¶œ
        User user = jwtTokenProvider.getUserInfoByToken(httpRequest);

        // ë””ìì´ë„ˆì¸ ê²½ìš°ì—ë§Œ í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„± (ì ‘ê·¼ì œì–´)
        if (user.isDesigner()) {
            // í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„±
            Portfolio portfolio = Portfolio.builder()
                    .user(user)
                    .name(portfolioReqDto.getName())
                    .phoneNumber(portfolioReqDto.getPhoneNumber())
                    .workplace(portfolioReqDto.getWorkplace())
                    .snsAddress(portfolioReqDto.getSnsAddress())
                    .introduction(portfolioReqDto.getIntroduction())
                    .likesCount(0)
                    .styling1(portfolioReqDto.getStyling1())
                    .cost1(portfolioReqDto.getCost1())
                    .styling2(portfolioReqDto.getStyling2())
                    .cost2(portfolioReqDto.getCost2())
                    .styling3(portfolioReqDto.getStyling3())
                    .cost3(portfolioReqDto.getCost3())
                    .styling4(portfolioReqDto.getStyling4())
                    .cost4(portfolioReqDto.getCost4())
                    .profileURL(portfolioReqDto.getProfileURL())
                    .certificateURL(portfolioReqDto.getCertificateURL())
                    .imageUrl1(portfolioReqDto.getImageUrl1())
                    .imageUrl2(portfolioReqDto.getImageUrl2())
                    .imageUrl3(portfolioReqDto.getImageUrl3())
                    .imageUrl4(portfolioReqDto.getImageUrl4())
                    .isAdvertise(0)
                    .build();



            // PortfolioHairStyles ì €ì¥
            List<PortfolioHairStyle> portfolioHairStyles = new ArrayList<>();

            // HairName1ì— í•´ë‹¹í•˜ëŠ” HairStyle ì°¾ê¸°
            HairStyle hairStyle1 = hairStyleRepository.findByHairName(portfolioReqDto.getHairName1());
            if (hairStyle1 != null) {
                PortfolioHairStyle portfolioHairStyle1 = PortfolioHairStyle.builder()
                        .portfolio(portfolio)
                        .hairStyle(hairStyle1)
                        .build();
                portfolioHairStyles.add(portfolioHairStyle1);
            }


            HairStyle hairStyle2 = hairStyleRepository.findByHairName(portfolioReqDto.getHairName2());;
            if (hairStyle2 != null) {
                PortfolioHairStyle portfolioHairStyle2 = PortfolioHairStyle.builder()
                        .portfolio(portfolio)
                        .hairStyle(hairStyle2)
                        .build();
                portfolioHairStyles.add(portfolioHairStyle2);
            }


            // HairName3ì— í•´ë‹¹í•˜ëŠ” HairStyle ì°¾ê¸°
            HairStyle hairStyle3 = hairStyleRepository.findByHairName(portfolioReqDto.getHairName3());;
            if (hairStyle3 != null) {
                PortfolioHairStyle portfolioHairStyle3 = PortfolioHairStyle.builder()
                        .portfolio(portfolio)
                        .hairStyle(hairStyle3)
                        .build();
                portfolioHairStyles.add(portfolioHairStyle3);
            }


            // PortfolioHairStyles ì €ì¥
            portfolioHairStyles.forEach(portfolioHairStyleRepository::save);


            // Portfolio ì €ì¥
            portfolioRepository.save(portfolio);

        } else {
            throw new RuntimeException("ë””ìì´ë„ˆê°€ ì•„ë‹Œ ì‚¬ìš©ìëŠ” í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
    }                
     ```
     
     - ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì¸ì¦ ê³¼ì • êµ¬í˜„ using Spring Security + ì¹´ì¹´ì˜¤ ë””ë²¨ë¡œí¼
     ```java
     @Override
    public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication)
            throws IOException, ServletException {
        OAuth2User oAuth2User = (OAuth2User) authentication.getPrincipal(); // ì¹´ì¹´ì˜¤ë¡œë¶€í„° ë°›ì€ ìœ ì € ì •ë³´
        User user = userRepository.findUserByKakaoId(oAuth2User.getAttribute("id"))
                .orElseThrow(() -> new UsernameNotFoundException("íšŒì›ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.")); // í•´ë‹¹ Idë¥¼ DBì—ì„œ ì¡°íšŒ
        String firstLogin = (user != null) ? "no" : "yes";
        String role = String.valueOf(user.getRole());

        String accessToken = jwtTokenProvider.createAccessToken(oAuth2User.getAttribute("id").toString(), role); //í† í°ë°œí–‰
        String refreshToken = jwtTokenProvider.createRefreshToken(oAuth2User.getAttribute("id").toString(), role); //í† í°ë°œí–‰
    
        String newtargetUrl;
        String referer = request.getHeader("Referer");
        if (referer.startsWith("http://localhost:3000/")) {
            newtargetUrl = UriComponentsBuilder.fromUriString("http://localhost:3000/auth")
                    .queryParam("accessToken", accessToken)
                    .queryParam("firstLogin", firstLogin)
                    .build().toUriString();
        } else {
            newtargetUrl = UriComponentsBuilder.fromUriString("https://morak-morak-demo.vercel.app/auth")
                    .queryParam("accessToken", accessToken)
                    .queryParam("firstLogin", firstLogin)
                    .build().toUriString();
        }
        getRedirectStrategy().sendRedirect(request, response, newtargetUrl);
    }
     ```

- AI
    -
    - ìœ ì € ì–¼êµ´í˜• ë¶„ì„ ë° ê²°ê³¼ ì „ì†¡
    ```python
    # ê°€ì¥ í™•ë¥ ì´ ë†’ê²Œ ì˜ˆì¸¡ëœ ì–¼êµ´í˜• (best shape)
    def predict_face_shape(image_path):
        img = preprocess_image(image_path)
        with torch.no_grad():
            outputs = model(img)
        _, predicted = torch.max(outputs, 1)
        predicted_class = class_labels[predicted.item()]
    return predicted_class

    # ê°€ì¥ í™•ë¥ ì´ ë‚®ê²Œ ì˜ˆì¸¡ëœ ì–¼êµ´í˜• (worst shape)
    def predict_least_likely_class(image_path):
        img = preprocess_image(image_path)
        with torch.no_grad():
        outputs = model(img)
        probabilities = torch.softmax(outputs, dim=1)
        least_likely_class_prob, least_likely_class_idx = torch.min(probabilities, dim=1)
        least_likely_class_label = class_labels[least_likely_class_idx.item()]
    return least_likely_class_label

    # ì„œë²„ì¸¡ìœ¼ë¡œ ì–¼êµ´í˜• íŒë³„ ê²°ê³¼ ì „ì†¡
    def post_json_data(predicted_class, least_likely_class_label, global_token):
    
    url = os.getenv('AWS_URL')

    headers = {
        'Content-Type': 'application/json',
        'Authorization': global_token
    }

    face = {
        "faceShapeBest": predicted_class,
        "faceShapeWorst": least_likely_class_label
    }

    data = json.dumps(face)

    try:
        response = requests.post(url, headers=headers, data=data)
        if response.status_code == 200:
            print("ì „ì†¡ ì„±ê³µ")
        else:
            print(" ì „ì†¡ ì‹¤íŒ¨ Status code:", response.status_code)
            print("ì˜¤ë¥˜ ë‚´ìš©:", response.text)
    except Exception as e:
        print("ì—ëŸ¬ ë°œìƒ:", e)
    ```

    - ì–¼êµ´í˜• ê¸°ë°˜ìœ¼ë¡œ ì–¼êµ´ê³¼ í—¤ì–´ì´ë¯¸ì§€ í•©ì„± ì‚¬ì§„ ìƒì„± ë° ì „ì†¡
    ```python
    def generate_and_upload_synthesized_images(file_path, predicted_class, least_likely_class_label, result_dir, current_datetime, kakao_id):

        # ìœ ì €ë³„ ì¹´ì¹´ì˜¤í†¡ ì•„ì´ë””ë¡œ í´ë” ë§Œë“¤ê¸°
        s3_results_dir = f"results/{kakao_id}"
        os.makedirs(result_dir, exist_ok=True)

        generated_images = []

        def generate_image_key(image_name):
            return f"{s3_results_dir}/{image_name}"

        # ê²°ê³¼ ì´ë¯¸ì§€ ìƒì„± ë° ì—…ë¡œë“œ
        for ref_image_dir in [f'asset/ref/{predicted_class}',   f'asset/ref/{least_likely_class_label}']:
            num_generated_images = 0
            for ref_image_name in os.listdir(ref_image_dir):
                if num_generated_images >= 3:
                    break

                target_image_path = os.path.join(ref_image_dir, ref_image_name)

                if not ref_image_name.endswith(('_back.npy', '_aligned.png')):
                    synthesized_image_path = generate_synthesized_image(target_image_path, file_path, result_dir)
                    generated_image_key = generate_image_key(ref_image_name)
                    upload_to_s3(s3_bucket_name, generated_image_key, synthesized_image_path, aws_access_key_id,
                             aws_secret_access_key, region_name)
                    generated_images.append(f"https://{s3_bucket_name}.s3.amazonaws.com/{generated_image_key}")
                    num_generated_images += 1

        return generated_images

    # í•©ì„± ì´ë¯¸ì§€ ìƒì„±
    def generate_synthesized_image(target_image_path, source_image_path, output_dir):

        cmd = f"python image_test.py --target_img_path {target_image_path} --source_img_path {source_image_path} --output_dir {output_dir} --use_gpu True"
        subprocess.run(cmd, shell=True, check=True)

        synthesized_image_name = "result_" + os.path.basename(target_image_path)
        synthesized_image_path = os.path.join(output_dir, synthesized_image_name)
    
    return synthesized_image_path


    @app.route('/predict', methods=['POST'])
    def predict():

        global global_token
        global global_kakao_id

        file = request.files['file']

        if not global_token or not global_kakao_id:
            return jsonify({'error': 'Missing token or kakao_id'}), 400

        current_dir = os.path.dirname(os.path.abspath(__file__))

        local_file_path = os.path.join(current_dir, 'uploads', file.filename)
        file.save(local_file_path)

        predicted_class = predict_face_shape(local_file_path)
        least_likely_class_label = predict_least_likely_class(local_file_path)

        current_datetime = datetime.datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
        result_dir = os.path.join('results', current_datetime)
        os.makedirs(result_dir, exist_ok=True)

        generated_images = generate_and_upload_synthesized_images(local_file_path, predicted_class, least_likely_class_label, result_dir, current_datetime, global_kakao_id)

        # ì–¼êµ´í˜• ë°ì´í„° ì „ì†¡
        post_json_data(predicted_class, least_likely_class_label, global_token)

        # ê²°ê³¼ í™”ë©´ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        redirect_url = f"https://morak-morak-demo.vercel.app/user?bestFace={predicted_class}&worstFace={least_likely_class_label}"

    return redirect(redirect_url)
    ```


## ğŸ”— ê¸°ìˆ  ë¸”ë¡œê·¸ ë§í¬
- ğŸ‘‰[ë°±ì—”ë“œ ì‘ì—…í™˜ê²½ ì„¸íŒ…í•˜ê¸°](https://jwkdevelop.tistory.com/131)
- ğŸ‘‰[í”„ë¡ íŠ¸ì—”ë“œ í”„ë¡œì íŠ¸ ìŠ¤ìºí´ë”© ê³¼ì •](https://shingy.tistory.com/56)
- ğŸ‘‰
- ğŸ‘‰

## ğŸ”— ìµœì¢… ë³´ê³ ì„œ ë§í¬
- ğŸ‘‰ [ìµœì¢… í”¼í”¼í‹° ë° ë³´ê³ ì„œ](https://jwkdevelop.tistory.com/133)
